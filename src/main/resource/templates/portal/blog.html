<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>On The Way</title>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <meta name="referrer" content="no-referrer"/>
        <script src="../../static/portal/js/common/commonJS.js"></script>
        <script src="../../static/portal/js/common/commonCss.js"></script>
    </head>

<style type="text/css">
    .form-center input,.form-center input{
        height: 50px;
        padding-left: 60px;
    }
    .form-control-feedback {
        line-height: 50px;
        right: 20px;
    }
</style>
<body>

    <nav>
        <div class="logo">
            <a href="index.html">ON THE WAY<!--<em>xy</em>--></a>
        </div>
      <div class="menu-icon">
        <span></span>
      </div>
    </nav>

    <div class="page-heading">
        <div class="container">
            <div class="heading-content">
                <h1>Our <em>Blog</em></h1>
            </div>
        </div>
    </div>


    <div class="blog-entries">
        <div class="container">
            <div class="col-md-9">
                <div class="blog-posts" th:fragment="article_type" id="contents_refresh">
                    <div id="contents" class="row"  th:each="resource:${resources.records}">
                        <div class="col-md-12">
                            <div class="blog-post">
                                <img src="img/blog_post_3.png" alt="">
                                <div class="text-content">
                                    <input type="hidden" id="page_totalnum" th:value="${resources.total}"/>
                                    <span><a href="#" th:text="${resource.nickname}"></a> /
                                        <a href="#" th:text="${#dates.format(resource.createTime, 'yyyy-MM-dd HH:mm:ss')}"></a> /
                                        <a href="#" th:text="${resource.type}"></a></span>
                                    <h2 th:text="${resource.title}"></h2>
                                    <p th:text="${resource.description}"></p>
                                    <div class="simple-btn">
                                       <a th:href="@{'../bizArticle/singlePost/'+${resource.id}}" target="_blank">继续阅读</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--<div class="col-md-12">
                            <div class="blog-post">
                                <img src="img/blog_post_1.png" alt="">
                                <div class="text-content">
                                    <span><a href="#">Admin</a> / <a href="#">16 September 2018</a> / <a href="#">Branding</a></span>
                                    <h2>Duis mollis orci vel lectus</h2>
                                    <p>Proin at augue quam. In laoreet arcu id lacus fringilla auctor. Etiam rutrum aliquet nisl, eu fermentum elit fermentum sed. Donec finibus urna sed sollicitudin egestas. In hac habitasse platea dictumst.
                                    <br><br>Phasellus purus turpis, porta non lectus vitae, laoreet blandit diam. Suspendisse elementum ligula at purus gravida, vel malesuada dolor accumsan. Morbi finibus dapibus ex, ut finibus felis.</p>
                                    <div class="simple-btn">
                                        <a href="single-post.html">continue reading</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                     -->

                    </div>
                </div>
                <div class="col-md-12">
                    <!--<ul class="page-number">
                        <li class="active"><a href="#">1</a></li>
                        <li><a href="#">2</a></li>
                        <li><a href="#">3</a></li>
                        <li><a href="#">></a></li>
                   </ul>-->
                    <div id="pageBox" style="width:1000px;margin: 30px auto;">
                    </div>
                </div>
            </div>
            <!--左侧菜单-->
<!--            <div class="col-md-3" id="right_meun" /></div>-->
            <div class="col-md-3"  id="meun_refresh">
                <div class="side-bar" >
                    <div class="search">
                        <fieldset>
                            <div class="input-group" style="width: 350px">
                                <span class="form-control-feedback glyphicon glyphicon-search" style="color: rgb(161, 160, 160); text-shadow: rgb(145, 145, 145) 145px 145px 145px; font-size: 20px;z-index:100" ></span>
                                <span style="display:inline-block;width:50px;height:50px;position:absolute;right:15px;z-index:100;cursor: pointer;"  onclick="search()"></span>
                                <input name="search" type="text" class="form-control" id="admdirector" placeholder="Search..." required="">
                                <!--                            <input type="text" class="form-control" id="admdirector" >-->
                                <div class="input-group-btn" >
                                    <ul class="dropdown-menu dropdown-menu-right" role="menu"></ul>
                                </div>
                            </div>
                        </fieldset>

                    </div>
                    <div class="categories">
                        <div class="sidebar-heding">
                            <h2>Categories</h2>
                        </div>
                        <div id="groupAritcle"></div>
                        <ul   th:fragment="article_groupAritcle" th:unless="not${groupAritcles}">
                            <li  th:each="groupAritcle:${groupAritcles}">
                                <a href="javascript:void(0)" th:text="${groupAritcle.name}+'('+${groupAritcle.count}+')'" th:onclick="quueryArticleGroup([[${groupAritcle.typeId}]])">> Lifestyle (7)</a>
                            </li>
                        </ul>
                    </div>
                    <div class="recent-posts">
                        <div class="sidebar-heding">
                            <h2>Recent Posts</h2>
                        </div>
                        <div id="recentPosts"></div>
                        <ul  th:fragment="article_recentPosts" th:unless="not${recentPosts}">
                            <li th:each="recentPost:${recentPosts.records}">
                                <a th:href="@{'../bizArticle/singlePost/'+${recentPost.id}}" target="_blank">
<!--                       <img th:src="@{recentPost.coverImage}" >-->
                                    <div class="row">
                                        <div class="col-md-3">
                                            <img th:src="${recentPost.avatar}" width="50px" height="50px"/>
                                        </div>
                                        <div class="col-md-9">
                                            <div class="text">
                                                <h6 th:text="${recentPost.title}">Duis mollis orci</h6>
                                                <span th:text="${#dates.format(recentPost.createTime, 'yyyy-MM-dd HH:mm:ss')}">15 September 2018</span>
                                            </div>
                                        </div>
                                    </div>
                            </a>
                            </li>
                        </ul>
                    </div>
                    <div class="archives">
                        <div class="sidebar-heding">
                            <h2>Archives</h2>
                        </div>
                        <ul id="recentSixMonthTotal">
                            <li><a href="#">> 2018 September (4)</a></li>
                        </ul>
                    </div>
                    <div class="latest-gallery">
                        <div class="sidebar-heding">
                            <h2>Latest Gallery</h2>
                        </div>
                        <ul >
                            <li><a href="#"></a><img src="img/latest_gallery_1.png" alt=""></a></li>
                            <li><a href="#"></a><img src="img/latest_gallery_2.png" alt=""></a></li>
                            <li><a href="#"></a><img src="img/latest_gallery_3.png" alt=""></a></li>
                            <li><a href="#"></a><img src="img/latest_gallery_4.png" alt=""></a></li>
                            <li><a href="#"></a><img src="img/latest_gallery_5.png" alt=""></a></li>
                            <li><a href="#"></a><img src="img/latest_gallery_6.png" alt=""></a></li>
                            <li><a href="#"></a><img src="img/latest_gallery_7.png" alt=""></a></li>
                            <li><a href="#"></a><img src="img/latest_gallery_8.png" alt=""></a></li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </div>


    <footer id="footer-way"></footer>


    <!-- Modal button -->
    <div class="popup-icon">
      <button id="modBtn" class="modal-btn"><img src="img/contact-icon.png" alt=""></button>
    </div>  

    <!-- Modal -->
    <div id="modal" class="modal">
      <!-- Modal Content -->
      <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
          <h3 class="header-title">Say hello to <em>Highway</em></h3>
          <div class="close-btn"><img src="img/close_contact.png" alt=""></div>    
        </div>
        <!-- Modal Body -->
        <div class="modal-body">
          <div class="col-md-6 col-md-offset-3">
            <form id="contact" action="" method="post">
                <div class="row">
                    <div class="col-md-12">
                      <fieldset>
                        <input name="name" type="text" class="form-control" id="name" placeholder="Your name..." required="">
                      </fieldset>
                    </div>
                    <div class="col-md-12">
                      <fieldset>
                        <input name="email" type="email" class="form-control" id="email" placeholder="Your email..." required="">
                      </fieldset>
                    </div>
                    <div class="col-md-12">
                      <fieldset>
                        <textarea name="message" rows="6" class="form-control" id="message" placeholder="Your message..." required=""></textarea>
                      </fieldset>
                    </div>
                    <div class="col-md-12">
                      <fieldset>
                        <button type="submit" id="form-submit" class="btn">Send Message Now</button>
                      </fieldset>
                    </div>
                </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!--目录-->
    <section class="overlay-menu"></section>
</body>

    <script>
        $(document).ready(function () {
            renderPageItem();
            initRightArchives();
            initLoadRecentPosts();
            initLoadArticleGroup();


        });
        $("#footer-way").load("/public/footer.html")
        $(".overlay-menu").load("/public/catalog.html")
        // $("#right_meun").load("/public/right.html")
        //回车事件绑定
        $('#admdirector').bind('keyup', function(event) {
            if (event.keyCode == "13") {
                //回车执行查询
                search()
            }
        });
        var admdirector = $("#admdirector").bsSuggest({
            indexId: 4, //data.value 的第几个数据，作为input输入框的内容
            indexKey: 0, //data.value 的第几个数据，作为input输入框的内容
            allowNoKeyword: false, //是否允许无关键字时请求数据
            multiWord: false, //以分隔符号分割的多关键字支持
            separator: ",", //多关键字支持时的分隔符，默认为空格
            getDataMethod: "url", //获取数据的方式，总是从 URL 获取
            effectiveFields:["java"],
            effectiveFieldsAlias:{java: "关键字"},
            showHeader: true,
            url: '../solr/spellCheck?keywords=', /*优先从url ajax 请求 json 帮助数据，注意最后一个参数为关键字请求参数*/
            processData: function(json){// url 获取数据时，对数据的处理，作为 getData 的回调函数
                var i, len, data = {value: []};
                if(!json || json.length == 0) {
                    return false;
                }
                len = json.length;
                for (i = 0; i < len; i++) {
                    data.value.push({
                        "java": json[i].java,
                    });
                }
                console.log(data);
                return data;
            }
        });

        /**
         ** 右侧档案数据
         * */
        function initRightArchives(){
            syncPost("../bizArticle/queryRecentSixMonthTotal","",function(data){
               var records =  data.data;
               $recentSixMonthTotal =  $("#recentSixMonthTotal")
               $recentSixMonthTotal.empty();
                    $.map(records,function (value,key) {
                        var param = key.replace("年","-").replace("月","-01")
                        var end = '"'+param+'"'
                        $recentSixMonthTotal.append("<li><a href='javascript:void(0);' target='_blank' onclick='quueryRightArchives("+end+")'>>"+key+'('+value +')'+"</a></li>")
                    })
                });
        }
        function quueryRightArchives(key){
            dateConditon = key
            render(1)
        }
        /**
         * 文章分组查询
         * */
        function quueryArticleGroup(key){
            typeId = key
            render(1)
        }
        /**
         * 最近文件
         * @param current
         */
        function initLoadRecentPosts(){
            $.ajax({
                url: "../bizArticle/recentPosts",
                type: 'POST',
                contentType: 'application/json; charset=UTF-8',
                success: function (data) {
                    $("#recentPosts").html(data);
                }
            })
        }

        /**
         * 文章分组
         * @param current
         */
        function initLoadArticleGroup(){
            $.ajax({
                url: "../bizArticle/queryAritcleGroupByType",
                type: 'POST',
                contentType: 'application/json; charset=UTF-8',
                success: function (data) {
                    $("#groupAritcle").html(data);
                }
            })
        }
        /**
         * 搜索
         * */
        function search(){
            // openPostWindow("../portal/search", $("#search").val())
            window.open("../solr/search?condition="+ $("#admdirector").val()+"&start=0&limit=20")
        }
        function openPostWindow(url, params) {
            var newWin = window.open()
            var formStr = '';
            //设置样式为隐藏，打开新标签再跳转页面前，如果有可现实的表单选项，用户会看到表单内容数据
            formStr = '<form style="visibility:hidden;" method="POST" action="' + url + '">' +
                '<input type="hidden" name="condition" value="' + params + '" />' +
                '</form>';

            newWin.document.body.innerHTML = formStr;
            newWin.document.forms[0].submit();
            return newWin;
        }
        var total = "[[${resources.total}]]",//数据总条数
            pageNumber = 1,//当前页
            pageSize = 4, //每页显示的条数
            edges = 2,//两侧显示的页码数 大于1
            playes = 5,//主页码区显示的页码数 大于3
            pages = 0,//总页数
            dateConditon='',//全局的日期条件查询
            typeId='';//文章分类

        /**
         * 构建查询条件
         * @param current
         */
        function createCondition(current){
            if(!current){
                current = 1
            }
            var param = {
                current:current,
                size:4
            }
            if(dateConditon){
                param.date=dateConditon
                param.typeId = ''
                return param
            }
            if(typeId){
                param.typeId = typeId
                param.date = ''
                return param
            }
            return param
        }
        function render(current) {
            var param = createCondition(current)
           /* syncPost("../bizArticle/blogList",param,function(data){
                $("#contents_refresh").html(data);
                total =  $("#page_totalnum").val()
                renderPageItem();
            })*/
            $.ajax({
                url: "../bizArticle/blogList",
                type: 'POST',
                data: JSON.stringify(param),
                contentType: 'application/json; charset=UTF-8',
                success: function (data) {
                    $("#contents_refresh").html(data);
                    total =  $("#page_totalnum").val()
                    renderPageItem();
                }
            })

            // syncPost("../bizArticle/queryCondition",param,function(data){
            //     var datas = data.data;
            //     var $content = $("#contents");
            //     $content.empty();
            //     datas.records.forEach(function (info) {
            //         $content.append('<div class="col-md-12"> <div class="blog-post"> <img src="img/blog_post_1.png" alt=""><div class="text-content"> <span>'
            //             + '<a href="#">'+ info.userId+'</a> /'
            //             + '<a href="#">'+ info.createTime+'</a> / '
            //             + '<a href="#">'+info.type+'</a></span>'
            //             + '<h2>'+info.title+'</h2>'
            //             + '<p>'+info.description+'</p>'
            //             + '<div class="simple-btn"><a href="../bizArticle/singlePost/'+info.id +'">继续阅读</a></div>'
            //             + ' </div> </div> </div>');
            //     });
            //     total = datas.total
            //     renderPageItem();
            // })

        }

        function renderPageItem() {
            $ul = $('<ul class="page-number"></ul>');
            var start = 1;
            pages = Math.ceil(total / pageSize)
            if(total<=12){
                playes = 1
                edges=1
            }else{
                playes = 5
                edges=2
            }
            var end = pages;

            if (playes % 2) {
                //playes是奇数
                start = pageNumber - Math.floor(playes / 2);
                end = pageNumber + Math.floor(playes / 2);
            } else {
                //playes是偶数
                start = pageNumber - (playes / 2 - 1);
                end = pageNumber + playes / 2;
            }

            if (start <= edges + 1) {
                start = 1;
                if (end < playes && playes<pages) {
                    end = playes;
                }
            } else {
                for (var i = 1; i <= edges; i++) {
                    $ul.append(renderItem(i));
                }
                $ul.append('<li><span>...</span></li>')
            }
            if (end < pages - edges) {
                for (var i = start; i <= end; i++) {
                    $ul.append(renderItem(i));
                }
                $ul.append('<li><span>...</span></li>');
                for (var i = pages - edges + 1; i <= pages; i++) {
                    $ul.append(renderItem(i));
                }
            } else {
                end = pages;
                if(start>pages-playes+1){
                    start = pages-playes+1
                }
                for (var i = start; i <= end; i++) {
                    $ul.append(renderItem(i));
                }
            }
            $ul.prepend(renderPrevItem());
            $ul.append(renderNextItem());
            $('#pageBox').empty().append($ul);

        }

        function renderItem(i) {
            $item = $('<li><a href="#">' + i + '</a></li>');
            if (i == pageNumber) {
                $item.addClass('active');
            }
            $item.on('click', (function (num) {
                return function () {
                    pageNumber = num;
                    renderPageItem();
                    render(pageNumber)
                }
            })(i));
            return $item
        }

        function renderPrevItem() {
            $prev = $('<li><a href="#">&laquo;</a></li>');
            if (pageNumber == 1) {
                $prev.addClass('disabled');
            } else {
                $prev.on('click', function () {
                    pageNumber = pageNumber - 1;
                    renderPageItem();
                    render(pageNumber)
                })
            }
            return $prev;
        }

        function renderNextItem() {
            $next = $('<li><a href="#">&raquo;</a></li>');
            if (pageNumber == pages) {
                $next.addClass('disabled');
            } else {
                $next.on('click', function () {
                    pageNumber = pageNumber + 1;
                    renderPageItem();
                    render(pageNumber)
                })
            }
            return $next;
        }

    </script>
</body>
</html>